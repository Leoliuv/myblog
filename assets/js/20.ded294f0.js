(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{195:function(a,s,t){"use strict";t.r(s);var e=t(0),l=Object(e.a)({},function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h3",{attrs:{id:"mysql慢日志监控配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql慢日志监控配置","aria-hidden":"true"}},[a._v("#")]),a._v(" MySQL慢日志监控配置")]),a._v(" "),t("h4",{attrs:{id:"mysql中日志包含"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql中日志包含","aria-hidden":"true"}},[a._v("#")]),a._v(" MySQL中日志包含")]),a._v(" "),t("p",[a._v("错误日志、二进制日志、通用查询日志、慢查询日志")]),a._v(" "),t("p",[a._v("a. 错误日志：记录启动、运行或停止mysqld时出现的问题。")]),a._v(" "),t("p",[a._v("b. 通用日志：记录建立的客户端连接和执行的语句。")]),a._v(" "),t("p",[a._v("c. 更新日志： 记录更改数据的语句。该日志在MySQL 5.1中已不再使用。")]),a._v(" "),t("p",[a._v("d. 二进制日志：记录所有更改数据的语句。还用于复制。")]),a._v(" "),t("p",[a._v("e. 记录所有执行时间超过long_query_time秒的所有查询或不使用索引的查询")]),a._v(" "),t("h4",{attrs:{id:"慢日志是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢日志是什么","aria-hidden":"true"}},[a._v("#")]),a._v(" 慢日志是什么")]),a._v(" "),t("p",[a._v("针对一个运行较慢的SQL，我们可能需要查看该SQL的“慢查询”日志，我们可以从这个日志中获取一些灵感，从而对SQL优化，减少查询时间。")]),a._v(" "),t("h4",{attrs:{id:"操作步骤："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作步骤：","aria-hidden":"true"}},[a._v("#")]),a._v(" 操作步骤：")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("登陆主机")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./bin/mysqld_safe --defaults-file=/paas/iddbs/liuli/mysql01/mysql/etc/my21000.cnf &\n./bin/mysql -umysql -pmysql -h127.0.0.1 -P21000\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查看慢日志开启状态")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show variables like '%quer%';\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570762216870.png",alt:"1570762216870"}})])]),a._v(" "),t("li",[t("p",[a._v("查看慢日志输出格式")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show varialbes like '%log_output%';\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570762298792.png",alt:"1570762298792"}})])]),a._v(" "),t("li",[t("p",[a._v("所有实例在线开启慢日志")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("set global slow_query_log=ON;\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570762383240.png",alt:"1570762383240"}})])]),a._v(" "),t("li",[t("p",[a._v("添加定时运行脚本&指定文件名")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('#!/bin/sh\nsource ~/.bash_profile\nexport LANG=en_US.UTF-8\n\n########## parameters ##########\n\ndbhost1="132.90.165.166"\ndbport1="3307"\n\ndbuser="mysql"\ndbpw="mysql"\n\nslowlogpath="/iddbs/monitor/slowsql"\nslowtime=10\n\nfile_date=`date "+%Y%m%d"`\n\n########## Command Begin ##########\nslowlogfile1=${dbhost1}"-"${dbport1}"-slowsql-"${file_date}".log"\n\nmysql -h${dbhost1} -P${dbport1} -u${dbuser} -p${dbpw} -e "set global long_query_time=${slowtime};set global slow_query_log_file=\'${slowlogpath}/${slowlogfile1}\';set global slow_query_log=1;"\n########## Command End ##########\n')])])])]),a._v(" "),t("li",[t("p",[a._v("查看慢日志")])])]),a._v(" "),t("h4",{attrs:{id:"数据库中参数注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库中参数注释","aria-hidden":"true"}},[a._v("#")]),a._v(" 数据库中参数注释")]),a._v(" "),t("ul",[t("li",[a._v("slow_query_log :的值为ON为开启慢查询日志，OFF则为关闭慢查询日志")]),a._v(" "),t("li",[a._v("slow_query_log_file :的值是记录的慢查询日志到文件中（注意：默认名为主机名.log，慢查询日志是否写入指定文件中，需要指定慢查询的输出日志格式为文件，相关命令为：show variables like ‘%log_output%’；去查看输出的格式）")]),a._v(" "),t("li",[a._v("long_query_time 指定了慢查询的阈值，即如果执行语句的时间超过该阈值则为慢查询语句，默认值为10秒")]),a._v(" "),t("li",[a._v("log_queries_not_using_indexes 如果值设置为ON，则会记录所有没有利用索引的查询（注意：如果只是将log_queries_not_using_indexes设置为ON，而将slow_query_log设置为OFF，此时该设置也不会生效，即该设置生效的前提是slow_query_log的值设置为ON），一般在性能调优的时候会暂时开启。如果调优的话，建议开启这个选项。另外，开启了这个参数，使用full index scan的sql也会被记录到慢查询日志")]),a._v(" "),t("li",[a._v("log_output 参数是指定日志的存储方式。log_output='FILE'表示将日志存入文件，默认值是'FILE'。log_output='TABLE'表示将日志存入数据库，这样日志信息就会被写入到mysql.slow_log表中。MySQL数据库支持同时两种日志存储方式，配置的时候以逗号隔开即可，如：log_output='FILE,TABLE'。日志记录到系统的专用日志表中，要比记录到文件耗费更多的系统资源，因此对于需要启用慢查询日志，又需要能够获得更高的系统性能，那么建议优先记录到文件。")])]),a._v(" "),t("h4",{attrs:{id:"验证："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证：","aria-hidden":"true"}},[a._v("#")]),a._v(" 验证：")]),a._v(" "),t("h5",{attrs:{id:"_1-临时开启慢查询日志（如果需要长时间开启，则需要更改mysql配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-临时开启慢查询日志（如果需要长时间开启，则需要更改mysql配置文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 1."),t("strong",[a._v("临时开启慢查询日志")]),a._v("（如果需要长时间开启，则需要更改mysql配置文件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("set global slow_query_log = on; \n")])])]),t("p",[t("img",{attrs:{src:"/ph/570764595787.png",alt:"1570764595787"}})]),a._v(" "),t("p",[a._v("注：如果想关闭慢查询日志，只需要执行 set global slow_query_log = off; 即可")]),a._v(" "),t("h5",{attrs:{id:"_2-临时设置慢查询时间临界点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-临时设置慢查询时间临界点","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.临时设置慢查询时间临界点")]),a._v(" "),t("p",[a._v("查询时间高于这个临界点的都会被记录到慢查询日志中（如果需要长时间开启，则需要更改mysql配置文件")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("set long_query_time = 0.001;\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570764626507.png",alt:"1570764626507"}})]),a._v(" "),t("p",[a._v("现在起，所有执行时间超过1秒的sql都将被记录到慢查询文件中")]),a._v(" "),t("h5",{attrs:{id:"_3-设置慢查询存储的方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-设置慢查询存储的方式","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.设置慢查询存储的方式")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("set globle log_output = file;\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570764744749.png",alt:"1570764744749"}})]),a._v(" "),t("p",[a._v("说明: 可以看到,我这里设置为了file,就是说我的慢查询日志是通过file体现的,默认是none,我们可以设置为table或者file,如果是table则慢查询信息会保存到mysql库下的slow_log表中")]),a._v(" "),t("h5",{attrs:{id:"_4-查询慢查询日志的开启状态和慢查询日志储存的位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询慢查询日志的开启状态和慢查询日志储存的位置","aria-hidden":"true"}},[a._v("#")]),a._v(" 4.查询慢查询日志的开启状态和慢查询日志储存的位置")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("show variables like '%quer%';\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570764681106.png",alt:"1570764681106"}})]),a._v(" "),t("p",[a._v("参数说明:")]),a._v(" "),t("p",[a._v("slow_query_log : 是否已经开启慢查询")]),a._v(" "),t("p",[a._v("slow_query_log_file : 慢查询日志文件路径")]),a._v(" "),t("p",[a._v("long_query_time :  超过多少秒的查询就写入日志")]),a._v(" "),t("p",[a._v("log_queries_not_using_indexes 如果值设置为ON，则会记录所有没有利用索引的查询(性能优化时开启此项,平时不要开启)")]),a._v(" "),t("h5",{attrs:{id:"_5-使用慢查询日志示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-使用慢查询日志示例","aria-hidden":"true"}},[a._v("#")]),a._v(" 5.使用慢查询日志示例")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("cat -n  /data/mysql/mysql-slow.log\n")])])]),t("p",[t("img",{attrs:{src:"/ph/570764356647.png",alt:"1570764356647"}})]),a._v(" "),t("h5",{attrs:{id:"_6-永久设置慢查询日志开启，以及设置慢查询日志时间临界点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-永久设置慢查询日志开启，以及设置慢查询日志时间临界点","aria-hidden":"true"}},[a._v("#")]),a._v(" 6.永久设置慢查询日志开启，以及设置慢查询日志时间临界点")]),a._v(" "),t("p",[a._v("在配置文件中更新参数即可")]),a._v(" "),t("p",[a._v("学习参考：")]),a._v(" "),t("p",[a._v("http://eip.teamshub.com/t/4227908?orgNo=10000&code=&ssologinid=FD7889F22C9B8F7EB32F6F95B9EB4463&ticket=ST-521797-SIAG3KwxE0dxKAx0H2KC-cas01.example.org")]),a._v(" "),t("p",[a._v("https://blog.csdn.net/m_nanle_xiaobudiu/article/details/79288257")])])},[],!1,null,null,null);s.default=l.exports}}]);