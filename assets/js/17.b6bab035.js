(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{200:function(a,s,t){"use strict";t.r(s);var l=t(0),e=Object(l.a)({},function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h4",{attrs:{id:"mysql-备份操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-备份操作","aria-hidden":"true"}},[a._v("#")]),a._v(" Mysql 备份操作")]),a._v(" "),t("h5",{attrs:{id:"_1-使用cp命令进行备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用cp命令进行备份","aria-hidden":"true"}},[a._v("#")]),a._v(" 1 使用cp命令进行备份")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mkdir backup ---\x3e cp -a ./mysql/21000/* ./mysql/backup/ \n参数：-a 保持源文件结构进行复制\n")])])]),t("h5",{attrs:{id:"_2-使用dump备份"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用dump备份","aria-hidden":"true"}},[a._v("#")]),a._v(" 2 使用dump备份")]),a._v(" "),t("p",[a._v("适用于所有存储引擎，支持温备份，完全备份，部分备份，对InnoDB支持热备，先使用mysqldump度数据进行\n完全备份，然后定期备份binary log达到增量备份、恢复，可以备份单库、单表、表结构等")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump [argument] > file_name\n")])])]),t("hr"),a._v(" "),t("h2",{attrs:{id:"备份导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备份导出","aria-hidden":"true"}},[a._v("#")]),a._v(" 备份导出")]),a._v(" "),t("h6",{attrs:{id:"_2-1-导出全部数据库表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-导出全部数据库表","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.1 导出全部数据库表")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump --socket-file=/paas/iddbs/liuli/mysql01/mysql/21000/mysql.sock -umysql -pmysql --all-databases > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000all.sql\nmysqldump -h127.0.0.1 -P21000 -uroot -proot --all-databases > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000all.sql\n<如果对添加的用户设置权限，则导出全部数据库表会出现权限不足>\n")])])]),t("h6",{attrs:{id:"_2-2-导出部分数据库表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-导出部分数据库表","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.2 导出部分数据库表")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump --socket-file=/paas/iddbs/liuli/mysql01/mysql/21000/mysql.sock -umysql -pmysql -databases test xxx.db > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000all.sql\nmysqldump -h127.0.0.1 -P21000 -uroot -proot -databases test xxx.db > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000part.sql\n")])])]),t("h6",{attrs:{id:"_2-3-导出单个数据库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-导出单个数据库","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.3 导出单个数据库")]),a._v(" "),t("p",[t("strong",[a._v("2.3.1 方法1")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump --socket-file=/paas/iddbs/liuli/mysql01/mysql/21000/mysql.sock -umysql -pmysql --databases test > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000all.sql\nmysqldump -h127.0.0.1 -P21000 -uroot -proot --databases test > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000partdata.sql\n")])])]),t("p",[t("strong",[a._v("2.3.2 方法2")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump --socket-file=/paas/iddbs/liuli/mysql01/mysql/21000/mysql.sock -umysql -pmysql --databases test > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000all.sql\nmysqldump -h127.0.0.1 -P21000 -uroot -proot test > /paas/iddbs/liuli/mysql01/mysql/21000dump/21000partnodata.sql\n")])])]),t("p",[a._v("区别：\n--databases在导出数据时会加上CREATE DATABASE 或 USE 语句，\n不使用--databases参数在导入数据时需要先指定一个存在的数据库作为默认数据库导入数据。")]),a._v(" "),t("h6",{attrs:{id:"_2-4导出数据库结构（不含数据）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4导出数据库结构（不含数据）","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.4导出数据库结构（不含数据）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump -u root -proot -h127.0.0.1 -P21000 -d test > /paas/iddbs/liuli/mysql01/mysql/21000dump/test.sql\n")])])]),t("h6",{attrs:{id:"_2-5-导出指定数据库表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-导出指定数据库表","aria-hidden":"true"}},[a._v("#")]),a._v(" 2.5 导出指定数据库表")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysqldump -h127.0.0.1 -P21000 -u root -proot test test01 > ./21000dump/test01.sql\n")])])]),t("p",[a._v("导入SQL格式文件\n​\t\t新建一个库")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("mysql> source /paas/iddbs/liuli/mysql01/mysql/21000dump/test.sql \n")])])]),t("p",[a._v("​\t\t错误：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("@@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.\n")])])]),t("p",[a._v("原因：在导出的库开启了GTID半同步复制，所以GTID_EXECUTED 的值不为空\n​解决：\n​reset mater 置空操作\n​在进行导出时加上--set-gtid-purged=off")]),a._v(" "),t("h4",{attrs:{id:"使用xtraback备份和恢复"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用xtraback备份和恢复","aria-hidden":"true"}},[a._v("#")]),a._v(" 使用xtraback备份和恢复")]),a._v(" "),t("h5",{attrs:{id:"_1）、准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1）、准备工作","aria-hidden":"true"}},[a._v("#")]),a._v(" 1）、准备工作")]),a._v(" "),t("p",[a._v("先安装percona-xtrabackup\n下载官网：https://www.percona.com/downloads/XtraBackup/LATEST/")]),a._v(" "),t("p",[a._v("下载好之后传到服务器上，然后解压\n解包：tar -zxvf FileName.tar")]),a._v(" "),t("p",[a._v("修改配置文件----根目录下面的 .bash_profile文件")]),a._v(" "),t("p",[a._v("vi .bash_profile")]),a._v(" "),t("p",[a._v("添加配置export PATH=$PATH:/paas/iddbs/liuli/mysql01/percona-xtrabackup-2.4.7-Linux-x86_64/bin")]),a._v(" "),t("p",[a._v("注意：添加的路径是解压后的percona-xtrabackup下面的bin目录所在的路径，用pwd就可以显示")]),a._v(" "),t("p",[a._v("然后在任意路径下，刷新配置文件 source ~/.bash_profile")]),a._v(" "),t("p",[a._v("刷新之后使用命令 innobackupex --help 来查看是否配置成功")]),a._v(" "),t("h5",{attrs:{id:"_2）全量备份操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2）全量备份操作","aria-hidden":"true"}},[a._v("#")]),a._v(" 2）全量备份操作")]),a._v(" "),t("p",[a._v("执行下面语句进行全备：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("innobackupex --defaults-file=/paas/iddbs/liuli/mysql01/mysql/etc/my21000.cnf --socket=/paas/iddbs/liuli/mysql01/mysql/21000/mysql.sock --user=root -proot /paas/iddbs/liuli/mysql01/mysql/21000xtra\n")])])]),t("p",[a._v("190510 14:51:53 completed OK!"),t("br"),a._v(" "),t("img",{attrs:{src:"/ph/1570515772111.png",alt:"1570515772111"}}),a._v("\n出现上述语句代表备份成功")]),a._v(" "),t("p",[a._v("上面执行的备份语句会将mysql数据文件（即由my21000.cnf里的变量datadir指定的）拷贝至备份目录下（/paas/iddbs/liuli/mysql01/mysql/21000xtra)")]),a._v(" "),t("h4",{attrs:{id:"全量备份后的恢复操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全量备份后的恢复操作","aria-hidden":"true"}},[a._v("#")]),a._v(" 全量备份后的恢复操作")]),a._v(" "),t("p",[a._v("注意：恢复之前\n1）要先关闭数据库\n2）要删除数据文件和日志文件（也可以mv移到别的地方，只要确保清空mysql数据存放目录就行） 清空data")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("innobackupex --defaults-file=/paas/iddbs/liuli/mysql01/mysql/etc/21000.cnf --user=root -proot --use-memory=1G --apply-log /paas/iddbs/liuli/mysql01/mysql/21000xtra/2019-10-08_14-21-27/  \ninnobackupex --defaults-file=/paas/iddbs/liuli/mysql01/mysql/etc/21000.cnf --uroot -proot --copy-back /paas/iddbs/liuli/mysql01/mysql/21000xtra/2019-10-08_14-21-27/\n\n")])])]),t("p",[t("em",[a._v("参数说明：")])]),a._v(" "),t("p",[a._v("--default-file=[my.cnf] 指定配置文件")]),a._v(" "),t("p",[a._v("--use-menory=# 此选项接受一个字符参数（1M/1MB,1G/1GB，默认100M），仅与--apply-log一起使用，该选项指定prepare时用于崩溃恢复（crash-recovery）的内存。")]),a._v(" "),t("p",[a._v("--apply-log  //应用 BACKUP-DIR 中的 xtrabackup_logfile 事务日志文件。一般情况下，在备份完成后，数据尚且不能用于恢复操作，因为备份的数据中可能会包含尚未提交的事务或已经提交但尚未同步至数据文件中的事务。因此，此时数据文件仍处于不一致状态。“准备”的主要作用正是通过回滚未提交的事务及同步已经提交的事务至数据文件使得数据文件处于一致性状态")]),a._v(" "),t("p",[a._v("--copy-back  //拷贝先前备份所有文件到它们的原始路径。但原路径下不能有任何文件或目录，除非指定 --force-non-empty-directories 选项")]),a._v(" "),t("p",[a._v("--force-non-empty-directories    //恢复时指定此选项，可使 --copy-back 和 --move-back 复制文件到非空目录，即原data目录下可以有其他文件，但是不能有与恢复文件中同名的文件，否则恢复失败。")]),a._v(" "),t("p",[a._v("170404 14:24:07  innobackupex: completed OK!")]),a._v(" "),t("p",[t("img",{attrs:{src:"/ph/1570517099296.png",alt:"1570517099296"}})]),a._v(" "),t("p",[a._v("出现上面的信息，说明数据恢复成功了")]),a._v(" "),t("p",[t("strong",[a._v("可参考博客")]),a._v("：https://www.cnblogs.com/waynechou/p/xtrabackup_backup.html")])])},[],!1,null,null,null);s.default=e.exports}}]);